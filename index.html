<!doctype html>
<html lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Neighborhood Map</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <script src="js/modernizr-custom.js"></script>
        <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
        <script src="js/knockout-3.4.0.js"></script>
        <script src="js/main.js"></script>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <div id="menu"><h3>Features of Raleigh, NC</h3>
        <div>
          <div class="text">Search for nearby places</div>
          <input id="places-search" type="text" placeholder="Ex: Cafes in Raleigh, NC">
          <input id="go-places" type="button" value="Go">
        </div>
        <br>
        <div>
          <input id="show-listings" type="button" value="Show Features">
          <input id="hide-listings" type="button" value="Hide Features">
        </div>
        <ul data-bind="foreach: featureList">
       	  <li data-bind="text: name, click: $parent.setFeature"></li>
    	</ul> 
		<div data-bind="with: currentFeature">
          <h3 data-bind="text: name"></h3>
          <div data-bind="text: lat"></div>
          <div data-bind="text: lng"></div>
          <!--<img data-bind="click: $parent.incrementCounter" src="" alt="">
  
          <h3>Nicknames</h3>
          <ul data-bind="foreach: $parent.featureList">
              <li data-bind="text: name"></li>
          </ul>-->  
        </div>
        </div>
        <div id="map"></div>
		<script>
		/*
          var map;
          function initMap() {
            // Constructor creates a new map - only center and zoom are required.
            map = new google.maps.Map(document.getElementById('map'), {
              center: {lat: 35.7904, lng: -78.6369},
              zoom: 13
            });
          }*/
		  
		  var map;

		  // Create a new blank array for all the listing markers.
		  var markers = [];
		  
		  // Create placemarkers array to use in multiple functions to have control
     	  // over the number of places that show.
          var placeMarkers = [];
		  
		  function initMap() {
		  // Create a styles array to use with the map.
		  var styles = [
			  {
				"featureType": "landscape",
				"stylers": [
				  {
					"hue": "#FFBB00"
				  },
				  {
					"saturation": 43.400000000000006
				  },
				  {
					"lightness": 37.599999999999994
				  },
				  {
					"gamma": 1
				  }
				]
			  },
			  {
				"featureType": "road.highway",
				"stylers": [
				  {
					"hue": "#FFC200"
				  },
				  {
					"saturation": -61.8
				  },
				  {
					"lightness": 45.599999999999994
				  },
				  {
					"gamma": 1
				  }
				]
			  },
			  {
				"featureType": "road.arterial",
				"stylers": [
				  {
					"hue": "#FF0300"
				  },
				  {
					"saturation": -100
				  },
				  {
					"lightness": 51.19999999999999
				  },
				  {
					"gamma": 1
				  }
				]
			  },
			  {
				"featureType": "road.local",
				"stylers": [
				  {
					"hue": "#FF0300"
				  },
				  {
					"saturation": -100
				  },
				  {
					"lightness": 52
				  },
				  {
					"gamma": 1
				  }
				]
			  },
			  {
				"featureType": "water",
				"stylers": [
				  {
					"hue": "#0078FF"
				  },
				  {
					"saturation": -13.200000000000003
				  },
				  {
					"lightness": 2.4000000000000057
				  },
				  {
					"gamma": 1
				  }
				]
			  },
			  {
				"featureType": "poi",
				"stylers": [
				  {
					"hue": "#00FF6A"
				  },
				  {
					"saturation": -1.0989010989011234
				  },
				  {
					"lightness": 11.200000000000017
				  },
				  {
					"gamma": 1
				  }
				]
			  }
			];
			
			// Constructor creates a new map - only center and zoom are required.
			map = new google.maps.Map(document.getElementById('map'), {
			  center: {lat: 35.7904, lng: -78.6369},
			  zoom: 13,
			  styles: styles,
			  mapTypeControl: false
			});
			
			// Create a searchbox in order to execute a places search
			var searchBox = new google.maps.places.SearchBox(
				document.getElementById('places-search'));
			// Bias the searchbox to within the bounds of the map.
			searchBox.setBounds(map.getBounds());
			


            var largeInfowindow = new google.maps.InfoWindow();
			
			// Style the markers a bit. This will be our listing marker icon.
			var defaultIcon = makeMarkerIcon('0091ff');
	
			// Create a "highlighted location" marker color for when the user
			// mouses over the marker.
			var highlightedIcon = makeMarkerIcon('FFFF24');
	
			// The following group uses the location array to create an array of markers on initialize.
			for (var i = 0; i < locations.length; i++) {
			  // Get the position from the location array.
			  var position = locations[i].location;
			  var title = locations[i].title;
			  // Create a marker per location, and put into markers array.
			  var marker = new google.maps.Marker({
				position: position,
				title: title,
				animation: google.maps.Animation.DROP,
				icon: defaultIcon,
				id: i
			  });
			  // Push the marker to our array of markers.
			  markers.push(marker);
			  // Create an onclick event to open the large infowindow at each marker.
			  marker.addListener('click', function() {
				populateInfoWindow(this, largeInfowindow);
			  });
			  // Two event listeners - one for mouseover, one for mouseout,
			  // to change the colors back and forth.
			  marker.addListener('mouseover', function() {
				this.setIcon(highlightedIcon);
			  });
			  marker.addListener('mouseout', function() {
				this.setIcon(defaultIcon);
			  });
			}
			
			  
			// Listen for the event fired when the user selects a prediction from the
			// picklist and retrieve more details for that place.
			searchBox.addListener('places_changed', function() {
			  searchBoxPlaces(this);
			});

			// Listen for the event fired when the user selects a prediction and clicks
			// "go" more details for that place.
			document.getElementById('go-places').addEventListener('click', textSearchPlaces);
		  }
		  
			document.getElementById('show-listings').addEventListener('click', showListings);
        	document.getElementById('hide-listings').addEventListener('click', hideListings);

	
		  // This function will loop through the markers array and display them all.
		  function showListings() {
			var bounds = new google.maps.LatLngBounds();
			// Extend the boundaries of the map for each marker and display the marker
			for (var i = 0; i < markers.length; i++) {
			  markers[i].setMap(map);
			  bounds.extend(markers[i].position);
			}
			map.fitBounds(bounds);
		  }
		  
		 // This function will loop through the listings and hide them all.
		 function hideListings() {
		   for (var i = 0; i < markers.length; i++) {
			 markers[i].setMap(null);
		   }
		 }
	
		  // This function will loop through the listings and hide them all.
		  function hideMarkers(markers) {
			for (var i = 0; i < markers.length; i++) {
			  markers[i].setMap(null);
			}
		  }
	
		  // This function takes in a COLOR, and then creates a new marker
		  // icon of that color. The icon will be 21 px wide by 34 high, have an origin
		  // of 0, 0 and be anchored at 10, 34).
		  function makeMarkerIcon(markerColor) {
			var markerImage = new google.maps.MarkerImage(
			  'http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|'+ markerColor +
			  '|40|_|%E2%80%A2',
			  new google.maps.Size(21, 34),
			  new google.maps.Point(0, 0),
			  new google.maps.Point(10, 34),
			  new google.maps.Size(21,34));
			return markerImage;
		  }
		  
			
		   // This function fires when the user selects a searchbox picklist item.
		  // It will do a nearby search using the selected query string or place.
		  function searchBoxPlaces(searchBox) {
			hideMarkers(placeMarkers);
			var places = searchBox.getPlaces();
			if (places.length == 0) {
			  window.alert('We did not find any places matching that search!');
			} else {
			// For each place, get the icon, name and location.
			  createMarkersForPlaces(places);
			}
		  }
	
		  // This function firest when the user select "go" on the places search.
		  // It will do a nearby search using the entered query string or place.
		  function textSearchPlaces() {
			var bounds = map.getBounds();
			hideMarkers(placeMarkers);
			var placesService = new google.maps.places.PlacesService(map);
			placesService.textSearch({
			  query: document.getElementById('places-search').value,
			  bounds: bounds
			}, function(results, status) {
			  if (status === google.maps.places.PlacesServiceStatus.OK) {
				createMarkersForPlaces(results);
			  }
			});
		  }
	
		  // This function creates markers for each place found in either places search.
		  function createMarkersForPlaces(places) {
			var bounds = new google.maps.LatLngBounds();
			for (var i = 0; i < places.length; i++) {
			  var place = places[i];
			  var icon = {
				url: place.icon,
				size: new google.maps.Size(35, 35),
				origin: new google.maps.Point(0, 0),
				anchor: new google.maps.Point(15, 34),
				scaledSize: new google.maps.Size(25, 25)
			  };
			  // Create a marker for each place.
			  var marker = new google.maps.Marker({
				map: map,
				icon: icon,
				title: place.name,
				position: place.geometry.location,
				id: place.place_id
			  });
			  // Create a single infowindow to be used with the place details information
			  // so that only one is open at once.
			  var placeInfoWindow = new google.maps.InfoWindow();
			  // If a marker is clicked, do a place details search on it in the next function.
			  marker.addListener('click', function() {
				if (placeInfoWindow.marker == this) {
				  console.log("This infowindow already is on this marker!");
				} else {
				  getPlacesDetails(this, placeInfoWindow);
				}
			  });
			  placeMarkers.push(marker);
			  if (place.geometry.viewport) {
				// Only geocodes have viewport.
				bounds.union(place.geometry.viewport);
			  } else {
				bounds.extend(place.geometry.location);
			  }
			}
			map.fitBounds(bounds);
		  }
	
		  // This is the PLACE DETAILS search - it's the most detailed so it's only
		  // executed when a marker is selected, indicating the user wants more
		  // details about that place.
		  function getPlacesDetails(marker, infowindow) {
			var service = new google.maps.places.PlacesService(map);
			service.getDetails({
			  placeId: marker.id
			}, function(place, status) {
			  if (status === google.maps.places.PlacesServiceStatus.OK) {
				// Set the marker property on this infowindow so it isn't created again.
				infowindow.marker = marker;
				var innerHTML = '<div>';
				if (place.name) {
				  innerHTML += '<strong>' + place.name + '</strong>';
				}
				if (place.formatted_address) {
				  innerHTML += '<br>' + place.formatted_address;
				}
				if (place.formatted_phone_number) {
				  innerHTML += '<br>' + place.formatted_phone_number;
				}
				if (place.opening_hours) {
				  innerHTML += '<br><br><strong>Hours:</strong><br>' +
					  place.opening_hours.weekday_text[0] + '<br>' +
					  place.opening_hours.weekday_text[1] + '<br>' +
					  place.opening_hours.weekday_text[2] + '<br>' +
					  place.opening_hours.weekday_text[3] + '<br>' +
					  place.opening_hours.weekday_text[4] + '<br>' +
					  place.opening_hours.weekday_text[5] + '<br>' +
					  place.opening_hours.weekday_text[6];
				}
				if (place.photos) {
				  innerHTML += '<br><br><img src="' + place.photos[0].getUrl(
					  {maxHeight: 100, maxWidth: 200}) + '">';
				}
				innerHTML += '</div>';
				infowindow.setContent(innerHTML);
				infowindow.open(map, marker);
				// Make sure the marker property is cleared if the infowindow is closed.
				infowindow.addListener('closeclick', function() {
				  infowindow.marker = null;
				});
			  }
		 });
	  }
	  
	  </script>		     
        
		
	  <script async defer
          src="https://maps.googleapis.com/maps/api/js?libraries=places,geometry,drawing&key=AIzaSyBFy6XVRHcWauQQ0QbsAYvuG6r4IwI_-co&v=3&callback=initMap">
      </script>
      <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.12.4.min.js"><\/script>')</script>


      <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
      <script>
          window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
          ga('create','UA-XXXXX-Y','auto');ga('send','pageview')
      </script>
      <script src="https://www.google-analytics.com/analytics.js" async defer></script>
    </body>
</html>
